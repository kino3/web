<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="doc-styles.css" type="text/css"/>
<title>Movable Typeユーザー・マニュアル: 既存環境からのアップグレード</title>
</head>

<body>
<h1 id="__index__">Movable Typeユーザー・マニュアル: 既存環境からのアップグレード</h1>
<p><a href="mtmanual.html">&laquo; 目次</a></p>

<p>既存の環境からアップグレードする場合、次のステップで行います。</p>

<div id="lists">
<ol>
<li><a href="#backup">既存の環境のバックアップを行います。</a></li>
<li><a href="#download">最新版のソフトウェアをダウンロードします。</a></li>
<li><a href="#extract">ダウンロードしたファイルをローカルのディレクトリで解凍し、Perlの実行環境にあわせ調整します。</a></li>
<li><a href="#config-cgi">環境設定ファイル (mt-config.cgi) の内容を実行環境にあわせ調整します。</a></li>
<li><a href="#upload">FTPプログラムでインストール先に転送します。</a></li>
<li><a href="#check-cgi">システム・チェックプログラム (mt-check.cgi) で実行環境を確認します。</a></li>
<li><a href="#setup">セットアッププログラムを実行します。</a></li>
</ol>
</div>

<div id="backup">
<h2>既存環境のバックアップ</h2>
<p>既存環境のバックアップには、以下のものがあります。特に「データベース」は、データ・フォーマットが新機能によりバージョンアップしているため重要です。</p>

<ol>
<li>データベース</li>
<li>環境設定ファイル</li>
<li>PerlやPHPのプログラム</li>
</ol>

<p>データベースのバックアップの方法には、大別して以下の方法があります。</p>

<ul>
<li><a href="#backup-all">利用しているデータベースのフルバックアップ</a></li>
<li><a href="#backup-entries">Movable Typeの「読み込み/書き出し」機能を使ったエントリー (コメント・トラックバックを含む) のバックアップ</a></li>
</ul>

<div id="backup-full">
<dt>MySQLの場合</dt>
<dd>MySQLのデータベースのバックアップ方法には、(1)コマンド行、(2)phpMyAdmin、(3)MySQL Administratorプログラムと多彩です。環境に応じて選択してください。phpMyAdminやMySQL Administratorを使ったバックアップは、それぞれのマニュアルを参照してください。コマンド行の場合は、以下のように実行すると、FILENAME.mysqlというバックアップ・ファイルが作成されます。</dd>
<pre><code>mysqldump -a -u USERNAME -p DATABASE > FILENAME.mysql</code></pre>

<dt>PostgreSQLの場合</dt>
<dd>PostgreSQLのデータベースのバックアップ方法には、(1)コマンド行、(2)phpPgAdmin、(3)PgAdminプログラムと多彩です。環境に応じて選択してください。phpPgAdminやPgAdminを使ったバックアップは、それぞれのマニュアルを参照してください。コマンド行の場合は、以下のように実行すると、FILENAME.pgというバックアップ・ファイルが作成されます。</dd>
<pre><code>Pg_dump --u=USERNAME --p DATABASE > FILENAME.pg</code></pre>

<dt>Berkeley DB、SQLiteの場合</dt>
<dd>Berkeley DBやSQLiteのデータベースのバックアップ方法は、MySQLやPostgreSQLと異なり、データベース・ファイル自身を別ディレクトリにコピーすることでバックアップができます。別ディレクトリにコピーしたファイルは、バックアップと認識できる名称でバックアップしてください。また、圧縮ツール等で圧縮するのもいい方法です。</dd>
</div>

<div id="backup-entries">
<p>Movable Typeからエントリーを書き出すと、万が一のときに備えユーザーの側でバックアップを保管できます。また、これらは、Movable Typeに再び、簡単に読み込めます。 ブログのエントリーとコメントを書き出すには、左側にあるブログ・ツールバーの「読み込み/書き出し」をクリックします。 「エントリーの書き出し」タブに「<em>…</em>からエントリーを書き出す」リンクがあります。 これをクリックすると、コンテンツの書き出しファイルが生成し、指定先にダウンロードします。 ブログのサイズによってはダウンロードにある程度の時間がかかることがあります。</p>
</div>
</div>

<div id="download">
<h2>最新版のダウンロード</h2>
<p>最新の配布パッケージは、<a href="http://www.movabletype.jp/get-mt.html">シックス・アパートのウェブサイト</a>からいつでもダウンロードできます。</p>
</div>

<div id="extract">
<h2>ファイルの解凍と修正</h2>
<p>ローカルに保存したパッケージを、解凍プログラムで適切なディレクトリに解凍します。先ほど確認したPerlの実行環境が初期値と異なる場合は、テキスト・エディタプログラムで、拡張子がcgiのファイルの1行目を修正してください。修正する際に<strong>-w</strong>を誤って削除しないように注意してください。</p>
</div>

<div id="config-cgi">
<h2>環境設定ファイルの修正</h2>
<p>Movable Type 3.2 では、環境設定ファイルとして、mt.cfg に代わり、mt-config.cgi を参照します。互換性を保つため、mt-config.cgi がない場合 mt.cfg も参照します。mt-config.cgi を使う場合には、これまで、mt-db-pass.cgi に記述していた、データベースに接続するときのパスワードを、mt-config.cgi の DBPassword に設定することに注意してください。

インストール先やデータベースの設定等を、全て環境設定ファイル (mt-config.cgi) に以下のように指定します。</p>
<ol>
<li>パッケージを解凍したディレクトリ内に、<strong>mt-config.cgi-original</strong>ファイルがあります。このファイルを<strong>mt-config.cgi</strong>にコピーします。</li>
<li><strong>mt-config.cgi</strong>をテキストエディタ等で修正します。行頭に#がある行は、コメント行です。必要に応じて#をはずしてください。</li>
<li>CGIPath (28行目) に、Perlスクリプトを保管するディレクトリパスを設定します。本例では、<strong>http://www.mt-site.jp/apps/</strong>となります。</li>
<li>次にデータベース・サーバーへのアクセス情報を設定します。利用するデータベースの環境にあわせ、31～71行目についてコメントをはずし、環境を技術します。57行目の<strong>SQLSetNames</strong>は、MySQL4.1やPostgreSQL8等のキャラクターセットを明示的に指定するデータベースを利用する場合コメントをはずします。</li>
<li>StaticWebPath (93行目) に、CGIPathで指定したパスに<strong>mt-static</strong>を追加します。本例では、<strong>http://www.mt-site.jp/apps/mt-static/</strong>となります。</li>
<li>TempDir (211行目) に、Movable Typeが生成するテンポラリー・ファイルの保存場所を指定します。</li>
<li>PublishCharset (272行目) に、Movable Typeが生成するHTMLファイルのキャラクターセットを指定します。通常はUTF-8ですが、EUCを指定する場合は<strong>euc-jp</strong>を、シフトJISを指定する場合は<strong>shift_jis</strong>を指定します。</li>
<li>利用の環境にあわせ、他の項目もカスタマイズします。</li>
<li>テキストエディタを終了し、保存します。</li>
</ol>
</div>

<div id="upload">
<h2>アップロード</h2>
<p>パッケージを解凍したディレクトリの内容を、ウェブ・サーバーのインストール先 (環境設定ファイルのCGIPathで指定している場所) に、FTPクライアントソフト等でアップロードします。アップロードの際は、mt-static/imagesディレクトリ内のファイルはバイナリーモードで、それ以外はASCIIモードでアップロードします。アップロード後、インストール先のディレクトリ内のCGIスクリプト (.cgiで終わる名前のファイル) の権限を<strong>755</strong>に設定します。</p>
</div>

<div id="check-cgi">
<h2>システム・チェック</h2>
<p>今までの作業について、システム・チェックプログラム (mt-check.cgi) を実行して最終確認を行います。本例では、<strong>http://www.mt-site.jp/apps/mt-check.cgi</strong>になります。実行の結果、「準備が整いました。」というメッセージを表示した場合、無事に作業が終了したことになります。このメッセージが表示されなかった場合、何らかの作業が完了していないので、続けて作業を行います。</p>
</div>

<div id="setup">
<h2>セットアッププログラムの実行</h2>
<p>システム・チェックが正常に終了したら、インストール先にあるセットアッププログラムを実行します。セットアッププログラムは、インストール先の<strong>index.html</strong>の「ログイン」リンクをクリックして実行します。本例では、<strong>http://www.mt-site.jp/apps/index.html</strong>になります。もし、このファイルへのアクセスができない場合には、<strong>mt.cgi</strong> へアクセスしログインします。ログイン後、画面の指示に従って、アップグレードを行ってください。</p>
<p>セットアッププログラムが正常に終了すると、「ログイン画面」が表示されます。これでインストールは終了です。お疲れ様でした。</p>
</div>

<hr />

<span class="copyright">Copyright &copy; 2001-2005 Six Apart, Ltd. All Rights Reserved.</span>
</body>
</html>
